<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SmartCal</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="dashboard.css"> -->
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logout-btn {
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
            margin-top: 20px;
        }
        .dashboard-card h3 {
            margin-bottom: 15px;
            color: #333;
        }
        .dashboard-card p {
            color: #666;
            margin-bottom: 20px;
        }
        .dashboard-btn {
            padding: 12px 24px;
            background: #000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .dashboard-btn:hover {
            background: #333;
        }
        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }
        .welcome-section h1 {
            margin-bottom: 10px;
        }
        .welcome-section p {
            opacity: 0.9;
        }
        .preferences-form {
            text-align: left;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .notification-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item.urgent {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .notification-subject {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .notification-message {
            color: #666;
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 12px;
            color: #999;
        }
        .form-control {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }
        .form-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }
        .checkbox-label {
            margin: 0;
            font-weight: normal;
        }
        .form-actions {
            margin-top: 20px;
            text-align: right;
        }
        .booking-page-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .booking-url {
            font-family: monospace;
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 10px 0;
            display: inline-block;
        }
        .booking-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .meetings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .meetings-table th,
        .meetings-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .meetings-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        .meetings-table tr:hover {
            background: #f8f9fa;
        }
        .no-meetings {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        /* Agenda Form Styles */
        .agenda-form {
            padding: 30px;
        }
        
        .form-section {
            margin-bottom: 30px;
        }
        
        .form-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .availability-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .day-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 120px;
        }
        
        .day-check {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }
        
        .day-checkbox label {
            font-weight: 500;
            color: #333;
            margin: 0;
        }
        
        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .time-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .time-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .time-range span {
            color: #666;
            font-size: 14px;
        }
        
        /* Success Modal Styles */
        .success-modal {
            max-width: 500px;
        }
        
        .success-content {
            padding: 30px;
            text-align: center;
        }
        
        .success-content p {
            margin-bottom: 25px;
            color: #333;
            font-size: 16px;
        }
        
        .booking-link-section {
            margin: 25px 0;
            text-align: left;
        }
        
        .booking-link-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #333;
        }
        
        .booking-link-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .success-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }
        
        /* Modal Body Styles */
        .modal-body {
            padding: 30px;
        }
        
        /* Calendar Management Styles */
        .calendar-section {
            margin-bottom: 30px;
        }
        
        .calendar-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .calendar-list {
            margin-bottom: 20px;
        }
        
        .calendar-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }
        
        .calendar-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .calendar-icon {
            font-size: 24px;
        }
        
        .calendar-details h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .calendar-details p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .calendar-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .sync-status.connected {
            background: #d4edda;
            color: #155724;
        }
        
        .sync-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .calendar-actions-section {
            margin-top: 20px;
        }
        
        .provider-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .provider-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .provider-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .provider-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .provider-card h4 {
            margin: 0 0 5px 0;
            color: #333;
        }
        
        .provider-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        /* Availability Management Styles */
        .availability-section {
            margin-bottom: 30px;
        }
        
        .availability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .availability-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .weekly-schedule {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .day-schedule {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .day-header h4 {
            margin: 0;
            color: #333;
            font-size: 1.1rem;
        }
        
        .day-toggle {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }
        
        .time-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .time-slot {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .time-start,
        .time-end {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .time-slot span {
            color: #666;
            font-size: 14px;
        }
        
        .btn-remove-slot {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }
        
        .btn-remove-slot:hover {
            background: #c82333;
        }
        
        .btn-add-slot {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-add-slot:hover {
            background: #218838;
        }
        
        .availability-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }
        
        /* Teams Management Styles */
        .teams-section {
            margin-bottom: 30px;
        }
        
        .teams-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .teams-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .teams-header h3 {
            margin: 0;
        }
        
        .teams-list {
            margin-bottom: 20px;
        }
        
        .no-teams {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .team-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="user-info">
                <img src="Assets/logo.png" alt="SmartCal" style="width: 40px; height: 40px;">
                <div>
                    <h3 id="userName">Welcome!</h3>
                    <p id="userEmail" style="margin: 0; color: #666;"></p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="notification-icon" onclick="showNotifications()" style="position: relative; cursor: pointer;">
                    <i class="fas fa-bell" style="font-size: 20px; color: #333;"></i>
                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="welcome-section">
            <h1>Welcome to SmartCal Dashboard</h1>
            <p>Manage your calendars, availability, and bookings all in one place</p>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>📅 Calendars</h3>
                <p>Create and manage your calendars. Set up your primary calendar and sync with external services.</p>
                <button class="dashboard-btn" onclick="showCalendars()">Manage Calendars</button>
            </div>

            <div class="dashboard-card">
                <h3>⏰ Availability</h3>
                <p>Set your weekly availability slots. Define when you're available for meetings.</p>
                <button class="dashboard-btn" onclick="showAvailability()">Set Availability</button>
            </div>

                    <div class="dashboard-card">
            <h3>📋 Agendas</h3>
            <p>Create booking pages for others to schedule meetings with you.</p>
            <button class="dashboard-btn" onclick="openAgendaModal()">Create New Agenda</button>
        </div>

            <div class="dashboard-card">
                <h3>👥 Teams</h3>
                <p>Create teams and schedule group meetings with multiple participants.</p>
                <button class="dashboard-btn" onclick="showTeams()">Manage Teams</button>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>🔗 Your Public Booking Links</h3>
            <p>Share these links with others to let them book meetings with you:</p>
            <div id="bookingLinks" style="text-align: left; margin-top: 20px;">
                <p>Loading your booking links...</p>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>🌐 Your Booking Page</h3>
            <div id="bookingPageSection" style="text-align: left; margin-top: 20px;">
                <p>Loading your booking page...</p>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>⚙️ Preferences</h3>
            <div class="preferences-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">Time Zone</label>
                        <select id="timezone" class="form-control">
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="Europe/London">London (GMT)</option>
                            <option value="Europe/Paris">Paris (CET)</option>
                            <option value="Asia/Tokyo">Tokyo (JST)</option>
                            <option value="Asia/Shanghai">Shanghai (CST)</option>
                            <option value="Australia/Sydney">Sydney (AEST)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="coverageBand">Coverage Band</label>
                        <select id="coverageBand" class="form-control">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="maxBookings">Max Bookings per Person</label>
                        <input type="number" id="maxBookings" class="form-control" value="3" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label for="dailyEmail">Daily Agenda Email</label>
                        <div class="checkbox-container">
                            <input type="checkbox" id="dailyEmail" class="form-checkbox">
                            <label for="dailyEmail" class="checkbox-label">Enable daily agenda emails</label>
                        </div>
                    </div>
                </div>
                <div class="form-row" id="sendTimeRow" style="display: none;">
                    <div class="form-group">
                        <label for="sendTime">Send Time</label>
                        <input type="time" id="sendTime" class="form-control" value="08:00">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="dashboard-btn" onclick="savePreferences()">Save Preferences</button>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>📅 Upcoming Meetings</h3>
            <div id="upcomingMeetings" style="text-align: left; margin-top: 20px;">
                <p>Loading your meetings...</p>
            </div>
        </div>
    </div>

    <!-- Agenda Creation Modal -->
    <div id="agendaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Booking Page</h2>
                <span class="close" onclick="closeAgendaModal()">&times;</span>
            </div>
            <form id="agendaForm" class="agenda-form">
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-group">
                        <label for="agendaTitle">Agenda Title *</label>
                        <input type="text" id="agendaTitle" class="form-control" placeholder="e.g., Team Meeting, Client Consultation" required>
                    </div>
                    <div class="form-group">
                        <label for="meetingDuration">Meeting Duration *</label>
                        <select id="meetingDuration" class="form-control" required>
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                            <option value="90">90 minutes</option>
                            <option value="120">2 hours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maxBookingsPerDay">Max Bookings per Day</label>
                        <input type="number" id="maxBookingsPerDay" class="form-control" value="5" min="1" max="20">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Availability Schedule</h3>
                    <div class="availability-grid">
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="monday" class="day-check">
                                <label for="monday">Monday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="mondayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="mondayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="tuesday" class="day-check" checked>
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="tuesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="tuesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="wednesday" class="day-check" checked>
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="wednesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="wednesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="thursday" class="day-check" checked>
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="thursdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="thursdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="friday" class="day-check" checked>
                                <label for="friday">Friday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="fridayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="fridayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="saturday" class="day-check">
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="saturdayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="saturdayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="sunday" class="day-check">
                                <label for="sunday">Sunday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="sundayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="sundayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAgendaModal()">Cancel</button>
                    <button type="submit" class="dashboard-btn">Create Booking Page</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-modal">
            <div class="modal-header">
                <h2>✅ Booking Page Created!</h2>
                <span class="close" onclick="closeSuccessModal()">&times;</span>
            </div>
            <div class="success-content">
                <p>Your booking page has been created successfully!</p>
                <div class="booking-link-section">
                    <label>Your Booking Link:</label>
                    <div class="booking-link-display">
                        <span id="generatedLink" class="booking-url"></span>
                        <button class="btn-secondary" onclick="copyGeneratedLink()">Copy</button>
                    </div>
                </div>
                <div class="success-actions">
                    <button class="btn-secondary" onclick="previewGeneratedLink()">Preview</button>
                    <button class="dashboard-btn" onclick="closeSuccessModal()">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Management Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>📅 Manage Calendars</h2>
                <span class="close" onclick="closeCalendarModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="calendar-section">
                    <h3>Connected Calendars</h3>
                    <div id="connectedCalendars" class="calendar-list">
                        <div class="calendar-item">
                            <div class="calendar-info">
                                <div class="calendar-icon">📅</div>
                                <div class="calendar-details">
                                    <h4>Primary Calendar</h4>
                                    <p>No calendars connected</p>
                                </div>
                            </div>
                            <div class="calendar-actions">
                                <span class="sync-status disconnected">Disconnected</span>
                                <button class="btn-secondary" onclick="connectCalendar()">Connect</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="calendar-actions-section">
                        <button class="dashboard-btn" onclick="connectNewCalendar()">
                            <span>🔗</span> Connect New Calendar
                        </button>
                    </div>
                </div>
                
                <div class="calendar-section">
                    <h3>Calendar Providers</h3>
                    <div class="provider-grid">
                        <div class="provider-card" onclick="connectGoogleCalendar()">
                            <div class="provider-icon">📧</div>
                            <h4>Google Calendar</h4>
                            <p>Connect your Google Calendar</p>
                        </div>
                        <div class="provider-card" onclick="connectOutlookCalendar()">
                            <div class="provider-icon">📊</div>
                            <h4>Outlook Calendar</h4>
                            <p>Connect your Outlook Calendar</p>
                        </div>
                        <div class="provider-card" onclick="connectAppleCalendar()">
                            <div class="provider-icon">🍎</div>
                            <h4>Apple Calendar</h4>
                            <p>Connect your Apple Calendar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Availability Management Modal -->
    <div id="availabilityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⏰ Set Availability</h2>
                <span class="close" onclick="closeAvailabilityModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="availability-section">
                    <div class="availability-header">
                        <h3>Weekly Schedule</h3>
                        <button class="btn-secondary" onclick="applyWeekdaySchedule()">Apply to Weekdays</button>
                    </div>
                    
                    <div class="weekly-schedule">
                        <div class="day-schedule" data-day="monday">
                            <div class="day-header">
                                <h4>Monday</h4>
                                <input type="checkbox" id="mondayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="mondaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('monday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="tuesday">
                            <div class="day-header">
                                <h4>Tuesday</h4>
                                <input type="checkbox" id="tuesdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="tuesdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('tuesday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="wednesday">
                            <div class="day-header">
                                <h4>Wednesday</h4>
                                <input type="checkbox" id="wednesdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="wednesdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('wednesday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="thursday">
                            <div class="day-header">
                                <h4>Thursday</h4>
                                <input type="checkbox" id="thursdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="thursdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('thursday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="friday">
                            <div class="day-header">
                                <h4>Friday</h4>
                                <input type="checkbox" id="fridayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="fridaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('friday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="saturday">
                            <div class="day-header">
                                <h4>Saturday</h4>
                                <input type="checkbox" id="saturdayEnabled" class="day-toggle">
                            </div>
                            <div class="time-slots" id="saturdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="10:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="15:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('saturday')">+ Add Time Slot</button>
                        </div>
                        
                        <div class="day-schedule" data-day="sunday">
                            <div class="day-header">
                                <h4>Sunday</h4>
                                <input type="checkbox" id="sundayEnabled" class="day-toggle">
                            </div>
                            <div class="time-slots" id="sundaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="10:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="15:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('sunday')">+ Add Time Slot</button>
                        </div>
                    </div>
                    
                    <div class="availability-actions">
                        <button class="btn-secondary" onclick="closeAvailabilityModal()">Cancel</button>
                        <button class="dashboard-btn" onclick="saveAvailability()">Save Availability</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teams Management Modal -->
    <div id="teamsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>👥 Manage Teams</h2>
                <span class="close" onclick="closeTeamsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="teams-section">
                    <div class="teams-header">
                        <h3>Your Teams</h3>
                        <button class="dashboard-btn" onclick="createNewTeam()">Create New Team</button>
                    </div>
                    
                    <div id="teamsList" class="teams-list">
                        <div class="no-teams">
                            <p>No teams created yet. Create your first team to get started!</p>
                        </div>
                    </div>
                </div>
                
                <div class="teams-section">
                    <h3>Team Settings</h3>
                    <div class="team-settings">
                        <div class="setting-group">
                            <label>Availability Rule:</label>
                            <select id="availabilityRule" class="form-control">
                                <option value="all">All members must be available</option>
                                <option value="majority">Majority of members available</option>
                                <option value="any">Any member available</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="notification-modal">
        <div class="notification-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>📢 Notifications</h3>
                <button onclick="closeNotifications()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div id="notificationList">
                <p>Loading notifications...</p>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        const token = localStorage.getItem('token');
        console.log('DEBUG: Dashboard loaded, checking token:', token ? 'Token exists' : 'No token');
        
        if (!token) {
            console.log('DEBUG: No token found, redirecting to login');
            window.location.href = '/login.html';
        }

        // Load user info
        async function loadUserInfo() {
            try {
                console.log('DEBUG: Loading user info with token:', token.substring(0, 20) + '...');
                console.log('DEBUG: Token length:', token.length);
                
                const response = await fetch('/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log('DEBUG: Response status:', response.status);
                
                if (response.ok) {
                    const user = await response.json();
                    console.log('DEBUG: User loaded successfully:', user.email);
                    document.getElementById('userName').textContent = `Welcome, ${user.name}!`;
                    document.getElementById('userEmail').textContent = user.email;
                } else {
                    // Token expired or invalid
                    console.log('DEBUG: Token validation failed, redirecting to login');
                    const errorText = await response.text();
                    console.log('DEBUG: Error response:', errorText);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/login.html';
            }
        }

        // Load booking links
        async function loadBookingLinks() {
            try {
                const response = await fetch('/agendas/', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const agendas = await response.json();
                    const linksContainer = document.getElementById('bookingLinks');
                    
                    if (agendas.length === 0) {
                        linksContainer.innerHTML = '<p>No booking pages created yet. Create an agenda to get started!</p>';
                    } else {
                        let linksHtml = '';
                        agendas.forEach(agenda => {
                            const bookingUrl = `${window.location.origin}/agendas/public/${agenda.alias_name}`;
                            linksHtml += `
                                <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 6px;">
                                    <strong>${agenda.alias_name}</strong><br>
                                    <a href="${bookingUrl}" target="_blank">${bookingUrl}</a>
                                </div>
                            `;
                        });
                        linksContainer.innerHTML = linksHtml;
                    }
                }
            } catch (error) {
                console.error('Error loading booking links:', error);
            }
        }

        // Load booking page section
        async function loadBookingPage() {
            try {
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                const bookingPageSection = document.getElementById('bookingPageSection');
                
                if (user.alias) {
                    const bookingUrl = `smartcal.one/${user.alias}`;
                    bookingPageSection.innerHTML = `
                        <div class="booking-page-section">
                            <strong>🌐 Your Booking Page: ${bookingUrl}</strong>
                            <div class="booking-url">${bookingUrl}</div>
                            <div class="booking-actions">
                                <button class="btn-secondary" onclick="copyBookingLink('${bookingUrl}')">Copy Link</button>
                                <button class="btn-secondary" onclick="previewBookingPage('${bookingUrl}')">Preview</button>
                            </div>
                        </div>
                    `;
                } else {
                    bookingPageSection.innerHTML = '<p>No booking pages created yet. Create an agenda to get started!</p>';
                }
            } catch (error) {
                console.error('Error loading booking page:', error);
            }
        }

        // Load upcoming meetings
        async function loadUpcomingMeetings() {
            try {
                const meetingsContainer = document.getElementById('upcomingMeetings');
                // For now, show no meetings - this will be implemented when meetings functionality is added
                meetingsContainer.innerHTML = `
                    <div class="no-meetings">
                        <p>You have no upcoming meetings. Check back soon!</p>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading meetings:', error);
            }
        }

        // Load user preferences
        async function loadUserPreferences() {
            try {
                const response = await fetch('/users/preferences', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const preferences = await response.json();
                    
                    // Set timezone
                    const timezoneSelect = document.getElementById('timezone');
                    timezoneSelect.value = preferences.timezone || 'UTC';
                    
                    // Set other preferences
                    document.getElementById('coverageBand').value = preferences.coverageBand || '30';
                    document.getElementById('maxBookings').value = preferences.maxBookings || '3';
                    document.getElementById('dailyEmail').checked = preferences.dailyEmail || false;
                    document.getElementById('sendTime').value = preferences.sendTime || '08:00';
                    
                    // Show/hide send time based on daily email checkbox
                    toggleSendTimeVisibility();
                } else {
                    console.error('Failed to load preferences');
                }
            } catch (error) {
                console.error('Error loading preferences:', error);
            }
        }

        // Toggle send time visibility based on daily email checkbox
        function toggleSendTimeVisibility() {
            const dailyEmail = document.getElementById('dailyEmail');
            const sendTimeRow = document.getElementById('sendTimeRow');
            sendTimeRow.style.display = dailyEmail.checked ? 'block' : 'none';
        }

        // Save user preferences
        async function savePreferences() {
            try {
                const preferences = {
                    timezone: document.getElementById('timezone').value,
                    coverageBand: parseInt(document.getElementById('coverageBand').value),
                    maxBookings: parseInt(document.getElementById('maxBookings').value),
                    dailyEmail: document.getElementById('dailyEmail').checked,
                    sendTime: document.getElementById('sendTime').value
                };
                
                const response = await fetch('/users/preferences', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(preferences)
                });
                
                if (response.ok) {
                    alert('Preferences saved successfully!');
                } else {
                    const error = await response.json();
                    alert('Error saving preferences: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving preferences:', error);
                alert('Error saving preferences. Please try again.');
            }
        }

        // Copy booking link to clipboard
        function copyBookingLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Booking link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Booking link copied to clipboard!');
            });
        }

        // Preview booking page
        function previewBookingPage(url) {
            window.open(`https://${url}`, '_blank');
        }

        function logout() {
            console.log('DEBUG: Logging out user');
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        function showCalendars() {
            openCalendarModal();
        }

        function showAvailability() {
            openAvailabilityModal();
        }

        // Modal functions
        function openAgendaModal() {
            document.getElementById('agendaModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeAgendaModal() {
            document.getElementById('agendaModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Reset form
            document.getElementById('agendaForm').reset();
        }
        
        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Refresh the booking links section
            loadBookingLinks();
            loadBookingPage();
        }
        
        // Handle agenda form submission
        document.getElementById('agendaForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('agendaTitle').value,
                duration: parseInt(document.getElementById('meetingDuration').value),
                maxBookingsPerDay: parseInt(document.getElementById('maxBookingsPerDay').value),
                availability: {}
            };
            
            // Collect availability data
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                const checkbox = document.getElementById(day);
                if (checkbox.checked) {
                    formData.availability[day] = {
                        start: document.getElementById(day + 'Start').value,
                        end: document.getElementById(day + 'End').value
                    };
                }
            });
            
            try {
                const response = await fetch('/agendas/create', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // Show success modal with generated link
                    document.getElementById('generatedLink').textContent = result.bookingUrl;
                    closeAgendaModal();
                    document.getElementById('successModal').style.display = 'block';
                } else {
                    const error = await response.json();
                    alert('Error creating agenda: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating agenda:', error);
                alert('Error creating agenda. Please try again.');
            }
        });
        
        // Copy generated link
        function copyGeneratedLink() {
            const link = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Booking link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Booking link copied to clipboard!');
            });
        }
        
        // Preview generated link
        function previewGeneratedLink() {
            const link = document.getElementById('generatedLink').textContent;
            window.open(link, '_blank');
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const agendaModal = document.getElementById('agendaModal');
            const successModal = document.getElementById('successModal');
            const calendarModal = document.getElementById('calendarModal');
            const availabilityModal = document.getElementById('availabilityModal');
            const teamsModal = document.getElementById('teamsModal');
            
            if (event.target === agendaModal) {
                closeAgendaModal();
            }
            if (event.target === successModal) {
                closeSuccessModal();
            }
            if (event.target === calendarModal) {
                closeCalendarModal();
            }
            if (event.target === availabilityModal) {
                closeAvailabilityModal();
            }
            if (event.target === teamsModal) {
                closeTeamsModal();
            }
        }
        
        // Calendar Management Functions
        function openCalendarModal() {
            console.log('Opening calendar modal...');
            const modal = document.getElementById('calendarModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Calendar modal opened successfully');
            } else {
                console.error('Calendar modal not found!');
                alert('Calendar modal not found!');
            }
        }
        
        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function connectCalendar() {
            alert('Calendar connection functionality coming soon!');
        }
        
        function connectNewCalendar() {
            alert('Connect new calendar functionality coming soon!');
        }
        
        function connectGoogleCalendar() {
            alert('Google Calendar integration coming soon!');
        }
        
        function connectOutlookCalendar() {
            alert('Outlook Calendar integration coming soon!');
        }
        
        function connectAppleCalendar() {
            alert('Apple Calendar integration coming soon!');
        }
        
        // Availability Management Functions
        function openAvailabilityModal() {
            console.log('Opening availability modal...');
            const modal = document.getElementById('availabilityModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Availability modal opened successfully');
            } else {
                console.error('Availability modal not found!');
                alert('Availability modal not found!');
            }
        }
        
        function closeAvailabilityModal() {
            document.getElementById('availabilityModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function addTimeSlot(day) {
            const slotsContainer = document.getElementById(day + 'Slots');
            const newSlot = document.createElement('div');
            newSlot.className = 'time-slot';
            newSlot.innerHTML = `
                <input type="time" class="time-start" value="09:00">
                <span>to</span>
                <input type="time" class="time-end" value="17:00">
                <button class="btn-remove-slot" onclick="removeTimeSlot(this)">×</button>
            `;
            slotsContainer.appendChild(newSlot);
        }
        
        function removeTimeSlot(button) {
            const slot = button.parentElement;
            const slotsContainer = slot.parentElement;
            if (slotsContainer.children.length > 1) {
                slot.remove();
            } else {
                alert('You must have at least one time slot per day.');
            }
        }
        
        function applyWeekdaySchedule() {
            const mondaySlots = document.getElementById('mondaySlots');
            const mondayStart = mondaySlots.querySelector('.time-start').value;
            const mondayEnd = mondaySlots.querySelector('.time-end').value;
            
            const weekdays = ['tuesday', 'wednesday', 'thursday', 'friday'];
            weekdays.forEach(day => {
                const slotsContainer = document.getElementById(day + 'Slots');
                const firstSlot = slotsContainer.querySelector('.time-slot');
                if (firstSlot) {
                    firstSlot.querySelector('.time-start').value = mondayStart;
                    firstSlot.querySelector('.time-end').value = mondayEnd;
                }
            });
            
            alert('Weekday schedule applied successfully!');
        }
        
        async function saveAvailability() {
            const availability = {};
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            
            days.forEach(day => {
                const enabled = document.getElementById(day + 'Enabled').checked;
                if (enabled) {
                    const slotsContainer = document.getElementById(day + 'Slots');
                    const slots = [];
                    slotsContainer.querySelectorAll('.time-slot').forEach(slot => {
                        slots.push({
                            start: slot.querySelector('.time-start').value,
                            end: slot.querySelector('.time-end').value
                        });
                    });
                    availability[day] = slots;
                }
            });
            
            try {
                const response = await fetch('/users/availability', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ availability })
                });
                
                if (response.ok) {
                    alert('Availability saved successfully!');
                    closeAvailabilityModal();
                } else {
                    const error = await response.json();
                    alert('Error saving availability: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving availability:', error);
                alert('Error saving availability. Please try again.');
            }
        }
        
        // Teams Management Functions
        function openTeamsModal() {
            console.log('Opening teams modal...');
            const modal = document.getElementById('teamsModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Teams modal opened successfully');
            } else {
                console.error('Teams modal not found!');
                alert('Teams modal not found!');
            }
        }
        
        function closeTeamsModal() {
            document.getElementById('teamsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function createNewTeam() {
            alert('Create new team functionality coming soon!');
        }

        function showTeams() {
            openTeamsModal();
        }

        // Notification functions
        async function loadNotifications() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/notifications', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const notifications = await response.json();
                    updateNotificationBadge(notifications.length);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function showNotifications() {
            const modal = document.getElementById('notificationModal');
            const notificationList = document.getElementById('notificationList');
            
            // Load notifications
            loadNotificationList();
            modal.style.display = 'block';
        }

        function closeNotifications() {
            document.getElementById('notificationModal').style.display = 'none';
        }

        async function loadNotificationList() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/notifications', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    const notifications = await response.json();
                    const notificationList = document.getElementById('notificationList');
                    
                    if (notifications.length === 0) {
                        notificationList.innerHTML = '<p>No notifications to display.</p>';
                        return;
                    }
                    
                    notificationList.innerHTML = '';
                    notifications.forEach(notification => {
                        const notificationItem = document.createElement('div');
                        notificationItem.className = `notification-item ${notification.urgent ? 'urgent' : ''}`;
                        notificationItem.innerHTML = `
                            <div class="notification-subject">${notification.subject}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${new Date(notification.createdAt).toLocaleString()}</div>
                        `;
                        notificationList.appendChild(notificationItem);
                    });
                }
            } catch (error) {
                console.error('Error loading notification list:', error);
                document.getElementById('notificationList').innerHTML = '<p>Error loading notifications.</p>';
            }
        }

        // Initialize dashboard
        loadUserInfo();
        loadBookingLinks();
        loadBookingPage();
        loadUpcomingMeetings();
        loadUserPreferences();
        loadNotifications();
        
        // Add event listener for daily email checkbox
        document.getElementById('dailyEmail').addEventListener('change', toggleSendTimeVisibility);
    </script>
</body>
</html> 