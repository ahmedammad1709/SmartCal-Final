<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SmartCal</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="dashboard.css"> -->
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-top: 20px;
        }

        .dashboard-card h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .dashboard-card p {
            color: #666;
            margin-bottom: 20px;
        }

        .dashboard-btn {
            padding: 12px 24px;
            background: #000;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .dashboard-btn:hover {
            background: #333;
        }

        .welcome-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
        }

        .welcome-section h1 {
            margin-bottom: 10px;
        }

        .welcome-section p {
            opacity: 0.9;
        }

        .preferences-form {
            text-align: left;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .notification-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item.urgent {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .notification-subject {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .notification-message {
            color: #666;
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 12px;
            color: #999;
        }

        .form-control {
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            width: 100%;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .valid-input {
            border: 2px solid #4CAF50 !important;
        }
        
        .invalid-input {
            border: 2px solid #f44336 !important;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
        }

        .form-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .checkbox-label {
            margin: 0;
            font-weight: normal;
        }

        .form-actions {
            margin-top: 20px;
            text-align: right;
        }

        .booking-page-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .booking-url {
            font-family: monospace;
            background: white;
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 10px 0;
            display: inline-block;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .meetings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        /* Booking Link Cards Styling */
        .booking-link-card {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .booking-link-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .booking-link-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
        }

        .booking-link-info {
            flex: 1;
        }

        .booking-title {
            margin: 0 0 4px 0;
            color: #2c3e50;
            font-weight: 600;
            font-size: 18px;
        }

        .booking-duration {
            color: #6c757d;
            font-size: 14px;
            font-weight: 500;
        }

        .booking-link-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .copy-btn {
            padding: 6px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background-color: #6c757d;
            color: white;
            border-color: #6c757d;
        }

        .copy-btn i {
            font-size: 12px;
        }

        /* Team display styles */
        .team-item {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            padding: 15px;
            transition: transform 0.2s;
        }

        .team-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .team-header h4 {
            margin: 0;
            color: #333;
            font-size: 18px;
            font-weight: 600;
        }

        .delete-team-btn {
            background-color: transparent;
            color: #ff5252;
            border: none;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s;
        }

        .delete-team-btn:hover {
            color: #ff0000;
        }

        .team-details {
            padding: 5px 0;
        }

        .team-duration {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .team-members {
            margin-top: 10px;
        }

        .members-title {
            font-weight: 500;
            margin: 5px 0;
            color: #555;
        }

        .members-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .team-member-item {
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 13px;
            color: #444;
        }
        
        /* Toast Notifications */
        .toast-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            animation: slideIn 0.3s ease;
        }

        .toast-notification.success {
            background-color: #28a745;
        }

        .toast-notification.error {
            background-color: #dc3545;
        }

        .toast-notification.info {
            background-color: #17a2b8;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .meetings-table th,
        .meetings-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .meetings-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .meetings-table tr:hover {
            background: #f8f9fa;
        }

        .no-meetings {
            text-align: center;
            color: #666;
            padding: 40px 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            opacity: 0.7;
        }

        /* Agenda Form Styles */
        .agenda-form {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .availability-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .day-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 120px;
        }

        .day-check {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .day-checkbox label {
            font-weight: 500;
            color: #333;
            margin: 0;
        }

        .time-range {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }

        .time-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }

        .time-range span {
            color: #666;
            font-size: 14px;
        }

        /* Success Modal Styles */
        .success-modal {
            max-width: 500px;
        }

        .success-content {
            padding: 30px;
            text-align: center;
        }

        .success-content p {
            margin-bottom: 25px;
            color: #333;
            font-size: 16px;
        }

        .booking-link-section {
            margin: 25px 0;
            text-align: left;
        }

        .booking-link-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: #333;
        }

        .booking-link-display {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .success-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        /* Modal Body Styles */
        .modal-body {
            padding: 30px;
        }

        /* Calendar Management Styles */
        .calendar-section {
            margin-bottom: 30px;
        }

        .calendar-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .calendar-list {
            margin-bottom: 20px;
        }

        .calendar-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            border: 1px solid #e9ecef;
        }

        .calendar-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .calendar-icon {
            font-size: 24px;
        }

        .calendar-details h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .calendar-details p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .calendar-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sync-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .sync-status.connected {
            background: #d4edda;
            color: #155724;
        }

        .sync-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .calendar-actions-section {
            margin-top: 20px;
        }

        .provider-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .provider-card {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .provider-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .provider-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .provider-card h4 {
            margin: 0 0 5px 0;
            color: #333;
        }

        .provider-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        /* Availability Management Styles */
        .availability-section {
            margin-bottom: 30px;
        }

        .availability-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .availability-header h3 {
            margin: 0;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .weekly-schedule {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .day-schedule {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .day-header h4 {
            margin: 0;
            color: #333;
            font-size: 1.1rem;
        }

        .day-toggle {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .time-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .time-slot {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .time-start,
        .time-end {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .time-slot span {
            color: #666;
            font-size: 14px;
        }

        .btn-remove-slot {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
        }

        .btn-remove-slot:hover {
            background: #c82333;
        }

        .btn-add-slot {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-add-slot:hover {
            background: #218838;
        }

        .availability-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        /* Teams Management Styles */
        .teams-section {
            margin-bottom: 30px;
        }

        .teams-section h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.2rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .teams-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .teams-header h3 {
            margin: 0;
        }

        .teams-list {
            margin-bottom: 20px;
        }

        .no-teams {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .team-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        /* Team Creation Modal Styles */
        .team-members-list {
            max-height: 250px;
            overflow-y: auto;
            margin-top: 10px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            min-height: 100px;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .member-existing {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
        }

        .member-outsider {
            background: #fff3cd;
            border: 1px solid #ffeeba;
        }

        .member-item:last-child {
            margin-bottom: 0;
        }

        .remove-member-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 16px;
        }

        .input-with-button {
            display: flex;
            gap: 10px;
        }

        .form-group {
            margin-top: 20px;
        }

        .form-actions {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
        }

        .btn-secondary {
            padding: 12px 24px;
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        .setting-group {
            margin-bottom: 15px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="user-info">
                <img src="Assets/logo.png" alt="SmartCal" style="width: 40px; height: 40px;">
                <div>
                    <h3 id="userName">Welcome!</h3>
                    <p id="userEmail" style="margin: 0; color: #666;"></p>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <div class="notification-icon" onclick="showNotifications()"
                    style="position: relative; cursor: pointer;">
                    <i class="fas fa-bell" style="font-size: 20px; color: #333;"></i>
                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="welcome-section">
            <h1>Welcome to SmartCal Dashboard</h1>
            <p>Manage your calendars, availability, and bookings all in one place</p>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3>üìÖ Calendars</h3>
                <p>Create and manage your calendars. Set up your primary calendar and sync with external services.</p>
                <button class="dashboard-btn" onclick="showCalendars()">Manage Calendars</button>
            </div>

            <div class="dashboard-card">
                <h3>‚è∞ Availability</h3>
                <p>Set your weekly availability slots. Define when you're available for meetings.</p>
                <button class="dashboard-btn" onclick="showAvailability()">Set Availability</button>
            </div>

            <div class="dashboard-card">
                <h3>üìã Agendas</h3>
                <p>Create booking pages for others to schedule meetings with you.</p>
                <button class="dashboard-btn" onclick="openAgendaModal()">Create New Agenda</button>
            </div>

            <div class="dashboard-card">
                <h3>üë• Teams</h3>
                <p>Create teams and schedule group meetings with multiple participants.</p>
                <button class="dashboard-btn" onclick="showTeams()">Manage Teams</button>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>üë• Your Teams</h3>
            <p>The teams you created so far</p>
            <div id="teamLinks" style="text-align: left; margin-top: 20px;">
                <p>Loading your Teams ...</p>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>üîó Your Public Booking Links</h3>
            <p>Share these links with others to let them book meetings with you:</p>
            <div id="bookingLinks" style="text-align: left; margin-top: 20px;">
                <p>Loading your booking links...</p>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>üåê Your Booking Page</h3>
            <div id="bookingPageSection" style="text-align: left; margin-top: 20px;">
                <p>Loading your booking page...</p>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>‚öôÔ∏è Preferences</h3>
            <div class="preferences-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="timezone">Time Zone</label>
                        <select id="timezone" class="form-control">
                            <option value="UTC">UTC</option>
                            <option value="America/New_York">Eastern Time (ET)</option>
                            <option value="America/Chicago">Central Time (CT)</option>
                            <option value="America/Denver">Mountain Time (MT)</option>
                            <option value="America/Los_Angeles">Pacific Time (PT)</option>
                            <option value="Europe/London">London (GMT)</option>
                            <option value="Europe/Paris">Paris (CET)</option>
                            <option value="Asia/Tokyo">Tokyo (JST)</option>
                            <option value="Asia/Shanghai">Shanghai (CST)</option>
                            <option value="Australia/Sydney">Sydney (AEST)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="coverageBand">Coverage Band</label>
                        <select id="coverageBand" class="form-control">
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="maxBookings">Max Bookings per Person</label>
                        <input type="number" id="maxBookings" class="form-control" value="3" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label for="dailyEmail">Daily Agenda Email</label>
                        <div class="checkbox-container">
                            <input type="checkbox" id="dailyEmail" class="form-checkbox">
                            <label for="dailyEmail" class="checkbox-label">Enable daily agenda emails</label>
                        </div>
                    </div>
                </div>
                <div class="form-row" id="sendTimeRow" style="display: none;">
                    <div class="form-group">
                        <label for="sendTime">Send Time</label>
                        <input type="time" id="sendTime" class="form-control" value="08:00">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="dashboard-btn" onclick="savePreferences()">Save Preferences</button>
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>üìÖ Upcoming Meetings</h3>
            <div id="upcomingMeetings" style="text-align: left; margin-top: 20px;">
                <p>Loading your meetings...</p>
            </div>
        </div>
    </div>

    <!-- Agenda Creation Modal -->
    <div id="agendaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Booking Page</h2>
                <span class="close" onclick="closeAgendaModal()">&times;</span>
            </div>
            <form id="agendaForm" class="agenda-form">
                <div class="form-section">
                    <h3>Basic Information</h3>
                    <div class="form-group">
                        <label for="agendaTitle">Agenda Title *</label>
                        <input type="text" id="agendaTitle" class="form-control"
                            placeholder="e.g., Team Meeting, Client Consultation" required>
                    </div>
                    <div class="form-group">
                        <label for="meetingDuration">Meeting Duration *</label>
                        <select id="meetingDuration" class="form-control" required>
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                            <option value="90">90 minutes</option>
                            <option value="120">2 hours</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="maxBookingsPerDay">Max Bookings per Day</label>
                        <input type="number" id="maxBookingsPerDay" class="form-control" value="5" min="1" max="20">
                    </div>
                </div>

                <div class="form-section">
                    <h3>Availability Schedule</h3>
                    <div class="availability-grid">
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="monday" class="day-check">
                                <label for="monday">Monday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="mondayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="mondayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="tuesday" class="day-check" checked>
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="tuesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="tuesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="wednesday" class="day-check" checked>
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="wednesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="wednesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="thursday" class="day-check" checked>
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="thursdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="thursdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="friday" class="day-check" checked>
                                <label for="friday">Friday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="fridayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="fridayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="saturday" class="day-check">
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="saturdayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="saturdayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="sunday" class="day-check">
                                <label for="sunday">Sunday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="sundayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="sundayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeAgendaModal()">Cancel</button>
                    <button type="submit" class="dashboard-btn">Create Booking Page</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content success-modal">
            <div class="modal-header">
                <h2>‚úÖ Booking Page Created!</h2>
                <span class="close" onclick="closeSuccessModal()">&times;</span>
            </div>
            <div class="success-content">
                <p>Your booking page has been created successfully!</p>
                <div class="booking-link-section">
                    <label>Your Booking Link:</label>
                    <div class="booking-link-display">
                        <span id="generatedLink" class="booking-url"></span>
                        <button class="btn-secondary" onclick="copyGeneratedLink()">Copy</button>
                    </div>
                </div>
                <div class="success-actions">
                    <button class="btn-secondary" onclick="previewGeneratedLink()">Preview</button>
                    <button class="dashboard-btn" onclick="closeSuccessModal()">Done</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Calendar Management Modal -->
    <div id="calendarModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÖ Manage Calendars</h2>
                <span class="close" onclick="closeCalendarModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="calendar-section">
                    <h3>Connected Calendars</h3>
                    <div id="connectedCalendars" class="calendar-list">
                        <div class="calendar-item">
                            <div class="calendar-info">
                                <div class="calendar-icon">üìÖ</div>
                                <div class="calendar-details">
                                    <h4>Primary Calendar</h4>
                                    <p>No calendars connected</p>
                                </div>
                            </div>
                            <div class="calendar-actions">
                                <span class="sync-status disconnected">Disconnected</span>
                                <button class="btn-secondary" onclick="connectCalendar()">Connect</button>
                            </div>
                        </div>
                    </div>

                    <div class="calendar-actions-section">
                        <button class="dashboard-btn" onclick="connectNewCalendar()">
                            <span>üîó</span> Connect New Calendar
                        </button>
                    </div>
                </div>

                <div class="calendar-section">
                    <h3>Calendar Providers</h3>
                    <div class="provider-grid">
                        <div class="provider-card" onclick="connectGoogleCalendar()">
                            <div class="provider-icon">üìß</div>
                            <h4>Google Calendar</h4>
                            <p>Connect your Google Calendar</p>
                        </div>
                        <div class="provider-card" onclick="connectOutlookCalendar()">
                            <div class="provider-icon">üìä</div>
                            <h4>Outlook Calendar</h4>
                            <p>Connect your Outlook Calendar</p>
                        </div>
                        <div class="provider-card" onclick="connectAppleCalendar()">
                            <div class="provider-icon">üçé</div>
                            <h4>Apple Calendar</h4>
                            <p>Connect your Apple Calendar</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Availability Management Modal -->
    <div id="availabilityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚è∞ Set Availability</h2>
                <span class="close" onclick="closeAvailabilityModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="availability-section">
                    <div class="availability-header">
                        <h3>Weekly Schedule</h3>
                        <button class="btn-secondary" onclick="applyWeekdaySchedule()">Apply to Weekdays</button>
                    </div>

                    <div class="weekly-schedule">
                        <div class="day-schedule" data-day="monday">
                            <div class="day-header">
                                <h4>Monday</h4>
                                <input type="checkbox" id="mondayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="mondaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('monday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="tuesday">
                            <div class="day-header">
                                <h4>Tuesday</h4>
                                <input type="checkbox" id="tuesdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="tuesdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('tuesday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="wednesday">
                            <div class="day-header">
                                <h4>Wednesday</h4>
                                <input type="checkbox" id="wednesdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="wednesdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('wednesday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="thursday">
                            <div class="day-header">
                                <h4>Thursday</h4>
                                <input type="checkbox" id="thursdayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="thursdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('thursday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="friday">
                            <div class="day-header">
                                <h4>Friday</h4>
                                <input type="checkbox" id="fridayEnabled" class="day-toggle" checked>
                            </div>
                            <div class="time-slots" id="fridaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="09:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="17:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('friday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="saturday">
                            <div class="day-header">
                                <h4>Saturday</h4>
                                <input type="checkbox" id="saturdayEnabled" class="day-toggle">
                            </div>
                            <div class="time-slots" id="saturdaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="10:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="15:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('saturday')">+ Add Time Slot</button>
                        </div>

                        <div class="day-schedule" data-day="sunday">
                            <div class="day-header">
                                <h4>Sunday</h4>
                                <input type="checkbox" id="sundayEnabled" class="day-toggle">
                            </div>
                            <div class="time-slots" id="sundaySlots">
                                <div class="time-slot">
                                    <input type="time" class="time-start" value="10:00">
                                    <span>to</span>
                                    <input type="time" class="time-end" value="15:00">
                                    <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
                                </div>
                            </div>
                            <button class="btn-add-slot" onclick="addTimeSlot('sunday')">+ Add Time Slot</button>
                        </div>
                    </div>

                    <div class="availability-actions">
                        <button class="btn-secondary" onclick="closeAvailabilityModal()">Cancel</button>
                        <button class="dashboard-btn" onclick="saveAvailability()">Save Availability</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Teams Management Modal -->
    <div id="teamsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• Manage Teams</h2>
                <span class="close" onclick="closeTeamsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="teams-section">
                    <div class="teams-header">
                        <h3>Your Teams</h3>
                        <button class="dashboard-btn" onclick="createNewTeam()">Create New Team</button>
                    </div>

                    <div id="teamsList" class="teams-list">
                        <div class="no-teams">
                            <p>No teams created yet. Create your first team to get started!</p>
                        </div>
                    </div>
                </div>

                <!-- <div class="teams-section">
                    <h3>Team Settings</h3>
                    <div class="team-settings">
                        <div class="setting-group">
                            <label>Availability Rule:</label>
                            <select id="availabilityRule" class="form-control">
                                <option value="all">All members must be available</option>
                                <option value="majority">Majority of members available</option>
                                <option value="any">Any member available</option>
                            </select>
                        </div>
                    </div>
                </div> -->
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="notification-modal">
        <div class="notification-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üì¢ Notifications</h3>
                <button onclick="closeNotifications()"
                    style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div id="notificationList">
                <p>Loading notifications...</p>
            </div>
        </div>
    </div>

    <script>
        // Check if user is logged in
        const token = localStorage.getItem('token');
        console.log('DEBUG: Dashboard loaded, checking token:', token ? 'Token exists' : 'No token');

        if (!token) {
            console.log('DEBUG: No token found, redirecting to login');
            window.location.href = '/login.html';
        }

        // Load user info
        async function loadUserInfo() {
            try {
                console.log('DEBUG: Loading user info with token:', token.substring(0, 20) + '...');
                console.log('DEBUG: Token length:', token.length);

                const response = await fetch('/users/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('DEBUG: Response status:', response.status);

                if (response.ok) {
                    const user = await response.json();
                    console.log('DEBUG: User loaded successfully:', user.email);
                    document.getElementById('userName').textContent = `Welcome, ${user.name}!`;
                    document.getElementById('userEmail').textContent = user.email;
                } else {
                    // Token expired or invalid
                    console.log('DEBUG: Token validation failed, redirecting to login');
                    const errorText = await response.text();
                    console.log('DEBUG: Error response:', errorText);
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                window.location.href = '/login.html';
            }
        }



        // Load upcoming meetings
        async function loadUpcomingMeetings() {
            try {
                const meetingsContainer = document.getElementById('upcomingMeetings');

                const response = await fetch('/meetings/upcoming', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Upcoming meetings data:', data);

                    if (data.meetings.length === 0) {
                        meetingsContainer.innerHTML = `
                            <div class="no-meetings">
                                <p>You have no upcoming meetings. Check back soon!</p>
                            </div>
                        `;
                    } else {
                        let meetingsHTML = '';
                        data.meetings.forEach(meeting => {
                            console.log('Meeting ID:', meeting.id, 'Type:', typeof meeting.id);
                            meetingsHTML += `
                                <div class="meeting-card" style="
                                    background: white;
                                    border: 1px solid #e0e0e0;
                                    border-radius: 8px;
                                    padding: 20px;
                                    margin-bottom: 15px;
                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                                ">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                                        <h4 style="margin: 0; color: #333; font-size: 16px;">${meeting.agenda_title}</h4>
                                        <span style="
                                            background: #007bff;
                                            color: white;
                                            padding: 4px 8px;
                                            border-radius: 4px;
                                            font-size: 12px;
                                            font-weight: bold;
                                        ">${meeting.duration} min</span>
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #555;">üë§ Visitor:</strong> ${meeting.visitor_name}
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #555;">üìß Email:</strong> <a href="mailto:${meeting.visitor_email}" style="color: #007bff; text-decoration: none;">${meeting.visitor_email}</a>
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #555;">üìÖ Date:</strong> ${meeting.formatted_date}
                                    </div>
                                    <div style="margin-bottom: 8px;">
                                        <strong style="color: #555;">‚è∞ Time:</strong> ${meeting.formatted_time}
                                    </div>
                                    <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            ${meeting.jitsi_link ? `
                                            <a href="${meeting.jitsi_link}" target="_blank" rel="noopener noreferrer" onclick="window.open('${meeting.jitsi_link}', '_blank'); return false;" style="
                                                display: inline-block;
                                                background: #28a745;
                                                color: white;
                                                padding: 8px 16px;
                                                border-radius: 4px;
                                                text-decoration: none;
                                                font-weight: bold;
                                                text-align: center;
                                                margin-right: 10px;
                                            ">
                                                <i class="fas fa-video"></i> Start Meeting
                                            </a>` : `
                                            <a href="#" onclick="alert('Meeting link not available yet. It will be available closer to the meeting time.'); return false;" style="
                                                display: inline-block;
                                                background: #6c757d;
                                                color: white;
                                                padding: 8px 16px;
                                                border-radius: 4px;
                                                text-decoration: none;
                                                font-weight: bold;
                                                text-align: center;
                                                margin-right: 10px;
                                            ">
                                                <i class="fas fa-video"></i> Start Meeting
                                            </a>`}
                                        </div>
                                        <button onclick="confirmDeleteMeeting('${meeting.id}')" style="
                                            display: inline-block;
                                            background: #dc3545;
                                            color: white;
                                            padding: 8px 16px;
                                            border-radius: 4px;
                                            border: none;
                                            text-decoration: none;
                                            font-weight: bold;
                                            text-align: center;
                                            cursor: pointer;
                                        ">
                                            <i class="fas fa-trash"></i> Delete Meeting
                                        </button>
                                    </div>
                                    <div style="font-size: 12px; color: #888; margin-top: 10px;">
                                        Booked on: ${new Date(meeting.created_at).toLocaleDateString()}
                                    </div>
                                </div>
                            `;
                        });

                        meetingsContainer.innerHTML = meetingsHTML;
                    }
                } else {
                    console.error('Failed to load meetings');
                    meetingsContainer.innerHTML = `
                        <div class="error-message">
                            <p>Error loading meetings. Please try again.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading meetings:', error);
                const meetingsContainer = document.getElementById('upcomingMeetings');
                meetingsContainer.innerHTML = `
                    <div class="error-message">
                        <p>Error loading meetings. Please try again.</p>
                    </div>
                `;
            }
        }

        // Load user preferences
        async function loadUserPreferences() {
            try {
                const response = await fetch('/users/preferences', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const preferences = await response.json();

                    // Set timezone
                    const timezoneSelect = document.getElementById('timezone');
                    timezoneSelect.value = preferences.timezone || 'UTC';

                    // Set other preferences
                    document.getElementById('coverageBand').value = preferences.coverageBand || '30';
                    document.getElementById('maxBookings').value = preferences.maxBookings || '3';
                    document.getElementById('dailyEmail').checked = preferences.dailyEmail || false;
                    document.getElementById('sendTime').value = preferences.sendTime || '08:00';

                    // Show/hide send time based on daily email checkbox
                    toggleSendTimeVisibility();
                } else {
                    console.error('Failed to load preferences');
                }
            } catch (error) {
                console.error('Error loading preferences:', error);
            }
        }

        // Toggle send time visibility based on daily email checkbox
        function toggleSendTimeVisibility() {
            const dailyEmail = document.getElementById('dailyEmail');
            const sendTimeRow = document.getElementById('sendTimeRow');
            sendTimeRow.style.display = dailyEmail.checked ? 'block' : 'none';
        }

        // Save user preferences
        async function savePreferences() {
            try {
                const preferences = {
                    timezone: document.getElementById('timezone').value,
                    coverageBand: parseInt(document.getElementById('coverageBand').value),
                    maxBookings: parseInt(document.getElementById('maxBookings').value),
                    dailyEmail: document.getElementById('dailyEmail').checked,
                    sendTime: document.getElementById('sendTime').value
                };

                const response = await fetch('/users/preferences', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(preferences)
                });

                if (response.ok) {
                    alert('Preferences saved successfully!');
                } else {
                    const error = await response.json();
                    alert('Error saving preferences: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving preferences:', error);
                alert('Error saving preferences. Please try again.');
            }
        }

        // Copy booking link to clipboard
        function copyBookingLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                alert('Booking link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Booking link copied to clipboard!');
            });
        }

        // Preview booking page
        function previewBookingPage(url) {
            window.open(`https://${url}`, '_blank');
        }

        function logout() {
            console.log('DEBUG: Logging out user');
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login.html';
        }

        function showCalendars() {
            openCalendarModal();
        }

        function showAvailability() {
            openAvailabilityModal();
        }

        // Modal functions
        function openAgendaModal() {
            document.getElementById('agendaModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeAgendaModal() {
            document.getElementById('agendaModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Reset form
            document.getElementById('agendaForm').reset();
        }

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Refresh the booking links section
            loadBookingLinks();
            loadBookingPage();
        }

        // Handle agenda form submission
        document.getElementById('agendaForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const formData = {
                title: document.getElementById('agendaTitle').value,
                duration: parseInt(document.getElementById('meetingDuration').value),
                maxBookingsPerDay: parseInt(document.getElementById('maxBookingsPerDay').value),
                availability: {}
            };

            // Collect availability data
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                const checkbox = document.getElementById(day);
                if (checkbox.checked) {
                    formData.availability[day] = {
                        start: document.getElementById(day + 'Start').value,
                        end: document.getElementById(day + 'End').value
                    };
                }
            });

            try {
                const response = await fetch('/agendas/create', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    const result = await response.json();
                    // Show success modal with generated link
                    document.getElementById('generatedLink').textContent = result.bookingUrl;
                    closeAgendaModal();
                    document.getElementById('successModal').style.display = 'block';
                } else {
                    const error = await response.json();
                    alert('Error creating agenda: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error creating agenda:', error);
                alert('Error creating agenda. Please try again.');
            }
        });

        // Copy generated link
        function copyGeneratedLink() {
            const link = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Booking link copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = link;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Booking link copied to clipboard!');
            });
        }

        // Preview generated link
        function previewGeneratedLink() {
            const link = document.getElementById('generatedLink').textContent;
            window.open(link, '_blank');
        }

        // Close modal when clicking outside
        // Note: This function has been moved to the initialization section

        // Calendar Management Functions
        function openCalendarModal() {
            console.log('Opening calendar modal...');
            const modal = document.getElementById('calendarModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Calendar modal opened successfully');
            } else {
                console.error('Calendar modal not found!');
                alert('Calendar modal not found!');
            }
        }

        function closeCalendarModal() {
            document.getElementById('calendarModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function connectCalendar() {
            alert('Calendar connection functionality coming soon!');
        }

        function connectNewCalendar() {
            alert('Connect new calendar functionality coming soon!');
        }

        function connectGoogleCalendar() {
            alert('Google Calendar integration coming soon!');
        }

        function connectOutlookCalendar() {
            alert('Outlook Calendar integration coming soon!');
        }

        function connectAppleCalendar() {
            alert('Apple Calendar integration coming soon!');
        }

        // Availability Management Functions
        function openAvailabilityModal() {
            console.log('Opening availability modal...');
            const modal = document.getElementById('availabilityModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Availability modal opened successfully');
            } else {
                console.error('Availability modal not found!');
                alert('Availability modal not found!');
            }
        }

        function closeAvailabilityModal() {
            document.getElementById('availabilityModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function addTimeSlot(day) {
            const slotsContainer = document.getElementById(day + 'Slots');
            const newSlot = document.createElement('div');
            newSlot.className = 'time-slot';
            newSlot.innerHTML = `
                <input type="time" class="time-start" value="09:00">
                <span>to</span>
                <input type="time" class="time-end" value="17:00">
                <button class="btn-remove-slot" onclick="removeTimeSlot(this)">√ó</button>
            `;
            slotsContainer.appendChild(newSlot);
        }

        function removeTimeSlot(button) {
            const slot = button.parentElement;
            const slotsContainer = slot.parentElement;
            if (slotsContainer.children.length > 1) {
                slot.remove();
            } else {
                alert('You must have at least one time slot per day.');
            }
        }

        function applyWeekdaySchedule() {
            const mondaySlots = document.getElementById('mondaySlots');
            const mondayStart = mondaySlots.querySelector('.time-start').value;
            const mondayEnd = mondaySlots.querySelector('.time-end').value;

            const weekdays = ['tuesday', 'wednesday', 'thursday', 'friday'];
            weekdays.forEach(day => {
                const slotsContainer = document.getElementById(day + 'Slots');
                const firstSlot = slotsContainer.querySelector('.time-slot');
                if (firstSlot) {
                    firstSlot.querySelector('.time-start').value = mondayStart;
                    firstSlot.querySelector('.time-end').value = mondayEnd;
                }
            });

            alert('Weekday schedule applied successfully!');
        }

        async function saveAvailability() {
            const availability = {};
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];

            days.forEach(day => {
                const enabled = document.getElementById(day + 'Enabled').checked;
                if (enabled) {
                    const slotsContainer = document.getElementById(day + 'Slots');
                    const slots = [];
                    slotsContainer.querySelectorAll('.time-slot').forEach(slot => {
                        slots.push({
                            start: slot.querySelector('.time-start').value,
                            end: slot.querySelector('.time-end').value
                        });
                    });
                    availability[day] = slots;
                }
            });

            try {
                const response = await fetch('/users/availability', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ availability })
                });

                if (response.ok) {
                    alert('Availability saved successfully!');
                    closeAvailabilityModal();
                } else {
                    const error = await response.json();
                    alert('Error saving availability: ' + (error.detail || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving availability:', error);
                alert('Error saving availability. Please try again.');
            }
        }

        // Teams Management Functions
        function openTeamsModal() {
            console.log('Opening teams modal...');
            const modal = document.getElementById('teamsModal');
            if (modal) {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                console.log('Teams modal opened successfully');
            } else {
                console.error('Teams modal not found!');
                alert('Teams modal not found!');
            }
        }

        function closeTeamsModal() {
            document.getElementById('teamsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function createNewTeam() {
            // Create the team creation modal if it doesn't exist
            let teamCreationModal = document.getElementById('teamCreationModal');

            if (!teamCreationModal) {
                // Create modal elements
                teamCreationModal = document.createElement('div');
                teamCreationModal.id = 'teamCreationModal';
                teamCreationModal.className = 'modal';

                const modalContent = document.createElement('div');
                modalContent.className = 'modal-content';

                const modalHeader = document.createElement('div');
                modalHeader.className = 'modal-header';
                modalHeader.innerHTML = `
                    <h2>Create New Team</h2>
                    <span class="close" onclick="closeTeamCreationModal()">&times;</span>
                `;

                const modalBody = document.createElement('div');
                modalBody.className = 'modal-body';
                modalBody.innerHTML = `
                     <div class="form-section">

                        <div class="form-group">
                             <label for="existingEmail">Enter Team Name :</label>
                             <div class="input-with-button">
                                 <input type="text" id="teamName" class="form-control" placeholder="Enter team name" required>
                             </div>
                         </div>

                         <div class="form-group">
                             <label for="existingEmail">Enter Existing Email</label>
                             <div class="input-with-button">
                                 <input type="email" id="existingEmail" class="form-control" placeholder="Enter team member email" oninput="validateEmail('existingEmail', 'existingEmailBtn')">
                                 <button id="existingEmailBtn" class="dashboard-btn" onclick="addExistingMember()" disabled>Add</button>
                             </div>
                         </div>
                         
                         <div class="form-group">
                             <label for="outsiderEmail">Add Outsider Email</label>
                             <div class="input-with-button">
                                 <input type="email" id="outsiderEmail" class="form-control" placeholder="Enter outsider email" oninput="validateEmail('outsiderEmail', 'outsiderEmailBtn')">
                                 <button id="outsiderEmailBtn" class="dashboard-btn" onclick="addOutsiderMember()" disabled>Add</button>
                             </div>
                         </div>
                         
                         <div class="form-group">
                             <label>Team Members</label>
                             <div id="teamMembersList" class="team-members-list">
                                 <p class="no-members">No members added yet</p>
                             </div>
                         </div>
                         
                          <div class="form-group">
                            <label for="meetingDuration">Meeting Duration *</label>
                            <select id="meetingDuration" class="form-control" required>
                            <option value="15">15 minutes</option>
                            <option value="30" selected>30 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="60">60 minutes</option>
                            <option value="90">90 minutes</option>
                            <option value="120">2 hours</option>
                            </select>
                        </div> <br/>


                        
                        <div class="form-section">
                            <h3>Availability Schedule</h3>
                        <div class="availability-grid">
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="monday" class="day-check">
                                <label for="monday">Monday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="mondayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="mondayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="tuesday" class="day-check" checked>
                                <label for="tuesday">Tuesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="tuesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="tuesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="wednesday" class="day-check" checked>
                                <label for="wednesday">Wednesday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="wednesdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="wednesdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="thursday" class="day-check" checked>
                                <label for="thursday">Thursday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="thursdayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="thursdayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="friday" class="day-check" checked>
                                <label for="friday">Friday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="fridayStart" class="time-input" value="09:00">
                                <span>to</span>
                                <input type="time" id="fridayEnd" class="time-input" value="17:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="saturday" class="day-check">
                                <label for="saturday">Saturday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="saturdayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="saturdayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                        <div class="day-row">
                            <div class="day-checkbox">
                                <input type="checkbox" id="sunday" class="day-check">
                                <label for="sunday">Sunday</label>
                            </div>
                            <div class="time-range">
                                <input type="time" id="sundayStart" class="time-input" value="10:00">
                                <span>to</span>
                                <input type="time" id="sundayEnd" class="time-input" value="15:00">
                            </div>
                        </div>
                    </div>
                </div>



                         <div class="form-actions">
                             <button class="btn-secondary" onclick="closeTeamCreationModal()">Cancel</button>
                             <button class="dashboard-btn" onclick="saveTeam()">Create Team</button>
                         </div>
                     </div>
                 `;

                modalContent.appendChild(modalHeader);
                modalContent.appendChild(modalBody);
                teamCreationModal.appendChild(modalContent);

                document.body.appendChild(teamCreationModal);
            }

            // Show the modal
            teamCreationModal.style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeTeamCreationModal() {
            const modal = document.getElementById('teamCreationModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';

                // Reset the form
                document.getElementById('existingEmail').value = '';
                document.getElementById('outsiderEmail').value = '';
                document.getElementById('teamMembersList').innerHTML = '<p class="no-members">No members added yet</p>';
            }
        }

        function validateEmail(inputId, buttonId) {
            const emailInput = document.getElementById(inputId);
            const addButton = document.getElementById(buttonId);
            const email = emailInput.value.trim();
            
            // Regular expression for email validation
            const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
            
            if (emailRegex.test(email)) {
                // Valid email format
                addButton.disabled = false;
                emailInput.classList.remove('invalid-input');
                emailInput.classList.add('valid-input');
            } else {
                // Invalid email format
                addButton.disabled = true;
                emailInput.classList.remove('valid-input');
                if (email !== '') {
                    emailInput.classList.add('invalid-input');
                } else {
                    emailInput.classList.remove('invalid-input');
                }
            }
        }
        
        function addExistingMember() {
            const emailInput = document.getElementById('existingEmail');
            const email = emailInput.value.trim();
            
            addMemberToList(email, 'existing');
            emailInput.value = '';
            document.getElementById('existingEmailBtn').disabled = true;
            emailInput.classList.remove('valid-input');
        }
        
        function addOutsiderMember() {
            const emailInput = document.getElementById('outsiderEmail');
            const email = emailInput.value.trim();
            
            addMemberToList(email, 'outsider');
            emailInput.value = '';
            document.getElementById('outsiderEmailBtn').disabled = true;
            emailInput.classList.remove('valid-input');
        }

        function addMemberToList(email, type) {
            const membersList = document.getElementById('teamMembersList');

            // Remove the 'no members' message if it exists
            const noMembersMsg = membersList.querySelector('.no-members');
            if (noMembersMsg) {
                membersList.removeChild(noMembersMsg);
            }

            // Create a new member item
            const memberItem = document.createElement('div');
            memberItem.className = 'member-item';
            memberItem.classList.add(type === 'existing' ? 'member-existing' : 'member-outsider');

            memberItem.innerHTML = `
                 <span>${email} ${type === 'outsider' ? '(Outsider)' : ''}</span>
                 <button onclick="this.parentNode.remove()" class="remove-member-btn">&times;</button>
             `;

            membersList.appendChild(memberItem);
        }

        async function saveTeam() {
            const teamName = document.getElementById('teamName').value.trim();
            const memberItems = document.querySelectorAll('.member-item');
            const meetingDuration = document.getElementById('meetingDuration').value;

            // Validate team name
            if (!teamName) {
                alert('Please enter a team name');
                return;
            }

            // Validate team members
            if (memberItems.length === 0) {
                alert('Please add at least one team member');
                return;
            }

            // Collect team members
            const members = [];
            memberItems.forEach(item => {
                const email = item.querySelector('span').textContent.split(' ')[0];
                const isOutsider = item.classList.contains('member-outsider');
                members.push({ email, isOutsider });
            });

            // Collect availability schedule
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            const availability = {};

            days.forEach(day => {
                const checkbox = document.getElementById(day);
                const startTime = document.getElementById(`${day}Start`).value;
                const endTime = document.getElementById(`${day}End`).value;

                availability[day] = {
                    isAvailable: checkbox.checked,
                    startTime: startTime,
                    endTime: endTime
                };
            });

            // Prepare data for API
            const teamData = {
                teamName,
                members,
                meetingDuration: parseInt(meetingDuration),
                availability
            };

            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('You must be logged in to create a team');
                    return;
                }

                // Show loading state
                const createButton = document.querySelector('.form-actions .dashboard-btn');
                const originalText = createButton.textContent;
                createButton.textContent = 'Creating...';
                createButton.disabled = true;

                const response = await fetch('/api/teams', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(teamData)
                });

                const result = await response.json();

                // Reset button state
                createButton.textContent = originalText;
                createButton.disabled = false;

                if (response.ok) {
                    // Show success modal
                    showSuccessModal('Team Created Successfully', 'Your team has been created and is ready to use.');
                    closeTeamCreationModal();
                    // Refresh teams list
                    loadTeams();
                } else {
                    alert(`Failed to create team: ${result.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error creating team:', error);
                alert('Failed to create team. Please try again.');
            }
        }

        function showTeams() {
            openTeamsModal();
        }

        async function loadTeams() {
            const teamLinksContainer = document.getElementById('teamLinks');
            teamLinksContainer.innerHTML = '<p>Loading your Teams...</p>';

            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    teamLinksContainer.innerHTML = '<p>Please log in to view your teams</p>';
                    return;
                }

                const response = await fetch('/api/teams', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (response.ok && result.teams) {
                    if (result.teams.length === 0) {
                        teamLinksContainer.innerHTML = '<p>You haven\'t created any teams yet. Click the "Create Team" button to get started.</p>';
                    } else {
                        teamLinksContainer.innerHTML = '';
                        result.teams.forEach(team => {
                            const teamElement = document.createElement('div');
                            teamElement.className = 'team-item';
                            teamElement.dataset.teamId = team.teamId;

                            // Create team header with name and delete button
                            const teamHeader = document.createElement('div');
                            teamHeader.className = 'team-header';
                            
                            const teamName = document.createElement('h4');
                            teamName.textContent = team.teamName;
                            
                            const deleteButton = document.createElement('button');
                            deleteButton.className = 'delete-team-btn';
                            deleteButton.innerHTML = '&times;';
                            deleteButton.onclick = () => confirmDeleteTeam(team.teamId, team.teamName);
                            
                            teamHeader.appendChild(teamName);
                            teamHeader.appendChild(deleteButton);
                            teamElement.appendChild(teamHeader);

                            // Create team details section
                            const teamDetails = document.createElement('div');
                            teamDetails.className = 'team-details';
                            
                            // Add meeting duration
                            const duration = document.createElement('p');
                            duration.className = 'team-duration';
                            duration.textContent = `Meeting Duration: ${team.meetingDuration} minutes`;
                            teamDetails.appendChild(duration);
                            
                            // Add members list
                            const membersList = document.createElement('div');
                            membersList.className = 'team-members';
                            
                            const membersTitle = document.createElement('p');
                            membersTitle.className = 'members-title';
                            membersTitle.textContent = 'Members:';
                            membersList.appendChild(membersTitle);
                            
                            const membersContainer = document.createElement('div');
                            membersContainer.className = 'members-container';
                            
                            team.members.forEach(member => {
                                const memberItem = document.createElement('div');
                                memberItem.className = 'team-member-item';
                                memberItem.textContent = member.email + (member.isOutsider ? ' (Outsider)' : '');
                                membersContainer.appendChild(memberItem);
                            });
                            
                            membersList.appendChild(membersContainer);
                            teamDetails.appendChild(membersList);
                            teamElement.appendChild(teamDetails);
                            
                            teamLinksContainer.appendChild(teamElement);
                        });
                    }
                } else {
                    teamLinksContainer.innerHTML = `<p>Error loading teams: ${result.error || 'Unknown error'}</p>`;
                }
            } catch (error) {
                console.error('Error loading teams:', error);
                teamLinksContainer.innerHTML = '<p>Failed to load teams. Please try again later.</p>';
            }
        }

        function confirmDeleteTeam(teamId, teamName) {
            if (confirm(`Are you sure you want to delete the team "${teamName}"? This action cannot be undone.`)) {
                deleteTeam(teamId);
            }
        }

        async function deleteTeam(teamId) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('You must be logged in to delete a team');
                    return;
                }

                const response = await fetch(`/api/teams/${teamId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    // Remove the team element from the DOM
                    const teamElement = document.querySelector(`.team-item[data-team-id="${teamId}"]`);
                    if (teamElement) {
                        teamElement.remove();
                    }
                    
                    // Show success message
                    showSuccessModal('Team Deleted', 'The team has been successfully deleted.');
                    
                    // If no teams left, show empty message
                    const teamLinksContainer = document.getElementById('teamLinks');
                    if (!teamLinksContainer.querySelector('.team-item')) {
                        teamLinksContainer.innerHTML = '<p>You haven\'t created any teams yet. Click the "Create Team" button to get started.</p>';
                    }
                } else {
                    alert(`Failed to delete team: ${result.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error deleting team:', error);
                alert('Failed to delete team. Please try again.');
            }
        }

        // Notification functions
        async function loadNotifications() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/notifications', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const notifications = await response.json();
                    updateNotificationBadge(notifications.length);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
            }
        }

        function updateNotificationBadge(count) {
            const badge = document.getElementById('notificationBadge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function showNotifications() {
            const modal = document.getElementById('notificationModal');
            const notificationList = document.getElementById('notificationList');

            // Load notifications
            loadNotificationList();
            modal.style.display = 'block';
        }

        function closeNotifications() {
            document.getElementById('notificationModal').style.display = 'none';
        }

        function showSuccessModal(title, message) {
            // Create modal elements
            const modal = document.createElement('div');
            modal.id = 'successModal';
            modal.style.display = 'block';
            modal.style.position = 'fixed';
            modal.style.zIndex = '1000';
            modal.style.left = '0';
            modal.style.top = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            
            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = 'white';
            modalContent.style.margin = '15% auto';
            modalContent.style.padding = '20px';
            modalContent.style.width = '50%';
            modalContent.style.maxWidth = '500px';
            modalContent.style.borderRadius = '8px';
            modalContent.style.textAlign = 'center';
            
            // Add success icon
            const icon = document.createElement('div');
            icon.innerHTML = '‚úÖ';
            icon.style.fontSize = '48px';
            icon.style.marginBottom = '15px';
            
            // Add title
            const titleElement = document.createElement('h3');
            titleElement.textContent = title;
            titleElement.style.margin = '10px 0';
            
            // Add message
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            messageElement.style.marginBottom = '20px';
            
            // Add close button
            const closeButton = document.createElement('button');
            closeButton.textContent = 'Close';
            closeButton.className = 'dashboard-btn';
            closeButton.onclick = function() {
                document.body.removeChild(modal);
            };
            
            // Assemble modal
            modalContent.appendChild(icon);
            modalContent.appendChild(titleElement);
            modalContent.appendChild(messageElement);
            modalContent.appendChild(closeButton);
            modal.appendChild(modalContent);
            
            // Add to body
            document.body.appendChild(modal);
            
            // Close when clicking outside
            modal.onclick = function(event) {
                if (event.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        async function loadNotificationList() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch('/notifications', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const notifications = await response.json();
                    const notificationList = document.getElementById('notificationList');

                    if (notifications.length === 0) {
                        notificationList.innerHTML = '<p>No notifications to display.</p>';
                        return;
                    }

                    notificationList.innerHTML = '';
                    notifications.forEach(notification => {
                        const notificationItem = document.createElement('div');
                        notificationItem.className = `notification-item ${notification.urgent ? 'urgent' : ''}`;
                        notificationItem.innerHTML = `
                            <div class="notification-subject">${notification.subject}</div>
                            <div class="notification-message">${notification.message}</div>
                            <div class="notification-time">${new Date(notification.createdAt).toLocaleString()}</div>
                        `;
                        notificationList.appendChild(notificationItem);
                    });
                }
            } catch (error) {
                console.error('Error loading notification list:', error);
                document.getElementById('notificationList').innerHTML = '<p>Error loading notifications.</p>';
            }
        }

        // Show/hide booking page section based on user's agendas
        async function updateBookingPageSection() {
            const section = document.getElementById('bookingPageSection');
            section.innerHTML = '<p>Loading your booking page...</p>';
            section.parentElement.style.display = 'block';
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    section.innerHTML = '<p>Please log in to view your booking page.</p>';
                    return;
                }
                // Use userId or alias for the portfolio link
                const portfolioUrl = user.id
                    ? `booking_page.html?userId=${encodeURIComponent(user.id)}`
                    : user.alias
                        ? `booking_page.html?alias=${encodeURIComponent(user.alias)}`
                        : 'booking_page.html';
                section.innerHTML = `<a href="${portfolioUrl}" target="_blank" class="btn btn-outline-primary">View Your Booking Page (Portfolio)</a><br><small>This is your public portfolio page. Share this link to let others see all your meeting types.</small>`;
            } catch (e) {
                console.error('‚ùå Error in updateBookingPageSection:', e);
                section.innerHTML = '<p>Error loading your booking page.</p>';
            }
        }

        // Show public booking links for each agenda
        async function updateBookingLinksSection() {
            const section = document.getElementById('bookingLinks');
            section.innerHTML = '<p>Loading your booking links...</p>';
            try {
                const token = localStorage.getItem('token');
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    section.innerHTML = '<p>Please log in to view your booking links.</p>';
                    return;
                }
                const response = await fetch('/agendas/', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) {
                    section.innerHTML = '<p>Error loading your agendas.</p>';
                    return;
                }
                const agendas = await response.json();
                console.log('üìã Loaded agendas:', agendas); // Debug log

                if (agendas.length === 0) {
                    section.innerHTML = '<p>You have not created any booking pages yet. Create one under Manage Agendas.</p>';
                    return;
                }
                let html = '';
                agendas.forEach(agenda => {
                    console.log('üìã Processing agenda:', agenda); // Debug log
                    const bookingUrl = `agenda_booking_link.html?user=${encodeURIComponent(user.name)}&agenda=${encodeURIComponent(agenda.title)}&duration=${encodeURIComponent(agenda.duration)}`;
                    const fullUrl = `${window.location.origin}/${bookingUrl}`;
                    html += `
                        <div class='booking-link-card'>
                            <div class='booking-link-content'>
                                <div class='booking-link-info'>
                                    <h5 class='booking-title'>${agenda.title}</h5>
                                    <span class='booking-duration'>${agenda.duration} min meeting</span>
                                </div>
                                <div class='booking-link-actions'>
                                    <a href='${bookingUrl}' target='_blank' class='btn btn-primary btn-sm'>View Booking Page</a>
                                    <button class='btn btn-outline-secondary btn-sm copy-btn' onclick='copyToClipboard("${fullUrl}")' title='Copy booking link'>
                                        <i class='fas fa-copy'></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                section.innerHTML = html;
            } catch (e) {
                console.error('‚ùå Error in updateBookingLinksSection:', e);
                section.innerHTML = '<p>Error loading your booking links.</p>';
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function () {
                // Show a nice toast notification instead of alert
                showToast('Link copied to clipboard!', 'success');
            }, function () {
                showToast('Failed to copy link.', 'error');
            });
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast-notification ${type}`;
            toast.textContent = message;

            // Add to page
            document.body.appendChild(toast);

            // Remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Function to confirm and delete a meeting
        function confirmDeleteMeeting(meetingId) {
            // Create a modal dialog for confirmation
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.top = '0';
            modal.style.left = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
            modal.style.display = 'flex';
            modal.style.justifyContent = 'center';
            modal.style.alignItems = 'center';
            modal.style.zIndex = '1000';

            const modalContent = document.createElement('div');
            modalContent.style.backgroundColor = 'white';
            modalContent.style.padding = '30px';
            modalContent.style.borderRadius = '8px';
            modalContent.style.width = '400px';
            modalContent.style.maxWidth = '90%';
            modalContent.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.2)';

            modalContent.innerHTML = `
                <h3 style="margin-top: 0; color: #333;">Confirm Deletion</h3>
                <p>Are you sure you want to delete this meeting? This action cannot be undone.</p>
                <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                    <button id="cancelDelete" style="
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        margin-right: 10px;
                        cursor: pointer;
                    ">Cancel</button>
                    <button id="confirmDelete" style="
                        background: #dc3545;
                        color: white;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                    ">Delete Meeting</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Add event listeners for the buttons
            document.getElementById('cancelDelete').addEventListener('click', function () {
                document.body.removeChild(modal);
            });

            document.getElementById('confirmDelete').addEventListener('click', function () {
                // Delete the meeting
                deleteMeeting(meetingId);
                document.body.removeChild(modal);
            });
        }

        // Function to delete a meeting
        async function deleteMeeting(meetingId) {
            try {
                console.log('Deleting meeting with ID:', meetingId);
                console.log('Using token:', token ? 'Token exists' : 'No token');

                // Convert meetingId to a number if it's a string
                const numericMeetingId = parseInt(meetingId, 10);

                const response = await fetch('/meetings/delete', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ meetingId: numericMeetingId })
                });

                console.log('Delete response status:', response.status);

                if (response.ok) {
                    // Reload the meetings list
                    loadUpcomingMeetings();
                    showToast('Meeting deleted successfully', 'success');
                } else {
                    const responseText = await response.text();
                    console.log('Error response text:', responseText);

                    let data;
                    try {
                        data = JSON.parse(responseText);
                    } catch (e) {
                        console.log('Failed to parse response as JSON');
                    }

                    showToast(data?.detail || 'Failed to delete meeting', 'error');
                }
            } catch (error) {
                console.error('Error deleting meeting:', error);
                showToast('Error deleting meeting. Please try again.', 'error');
            }
        }

        // Initialize dashboard
        loadUserInfo();
        loadUpcomingMeetings();
        loadUserPreferences();
        loadTeams(); // Load teams
        loadNotifications();
        updateBookingPageSection(); // Call this function on page load
        updateBookingLinksSection(); // Call this function on page load

        // Add event listener for daily email checkbox
        document.getElementById('dailyEmail').addEventListener('change', toggleSendTimeVisibility);

        // Add event listener for team creation modal
        window.onclick = function (event) {
            const agendaModal = document.getElementById('agendaModal');
            const successModal = document.getElementById('successModal');
            const calendarModal = document.getElementById('calendarModal');
            const availabilityModal = document.getElementById('availabilityModal');
            const teamsModal = document.getElementById('teamsModal');
            const teamCreationModal = document.getElementById('teamCreationModal');

            if (event.target === agendaModal) {
                closeAgendaModal();
            }
            if (event.target === successModal) {
                // Check if it's the dynamically created success modal or the static one
                if (successModal.id === 'successModal' && successModal.parentNode) {
                    // For dynamically created modal
                    successModal.parentNode.removeChild(successModal);
                } else {
                    // For static modal
                    closeSuccessModal();
                }
            }
            if (event.target === calendarModal) {
                closeCalendarModal();
            }
            if (event.target === availabilityModal) {
                closeAvailabilityModal();
            }
            if (event.target === teamsModal) {
                closeTeamsModal();
            }
            if (event.target === teamCreationModal) {
                closeTeamCreationModal();
            }
        }
    </script>
</body>

</html>